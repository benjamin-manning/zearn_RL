#6. update theta_sigma. Like so: theta_sigma = theta_sigma + alpha_theta * delta*gamma^(week -1 #) *
#((minutes - mu)^2/(sigma)^2 - 1) * x’s  [this is the second gradient formula from the picture]
sig_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
sig_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
((minutes-mu)^2/((sigma^2-1))) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
}
}
# 7. Loop accordingly until the end of the 40 weeks
View(sig_theta_df)
mu
40*(teacher-1)+week
library(tidyverse)
library(reshape2)
nweeks <- 40
nteachers = 100
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
View(mu_theta_df)
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
View(sig_theta_df)
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
View(state_var_df)
#w starting
w_df = matrix(data = NA, nrow = nweeks , ncol = 5)
colnames(w_df) = c('week', 'w1', 'w2', 'w3', 'w4')
w_df[1,] = c(1, 0, 0, 0, 0)
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
View(w_df)
source("~/Desktop/zearn/zearn_RL/guassian_sim_V2.R", echo=TRUE)
nweeks <- 40
nteachers = 100
# 1. Initialize: alpha_theta >0, alpha_w > 0; theta_mu, theta_sigma, w (vectors size 4);
# S (x) (which is the vector size 4 we call x’s — badges, tower alerts, squares…)
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
#w starting
w_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(w_df) = c('week', 'teacher', 'w1', 'w2', 'w3', 'w4')
#FIX HERE
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
# 2. Calculate mu and theta. Sample minutes from the resulting normal distribution.
teacher = 1
#selecting thetas MAKE ALL THESE 0 to START
mu_theta_df[40* (teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
sig_theta_df[40*(teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
#starting state variables for each teacher (the same?)
last_badges = 2
last_tower_alerts = 6
state_var_df[40*(teacher-1)+1,] = c(1, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#initializing w for each teacher
w_df[40*(teacher-1)+1,]= c(1, teacher,
0, 0, 0, 0)
#making first column teacher
sim_mins_df[teacher,1] = teacher
View(mu_theta_df)
View(sig_theta_df)
View(sim_mins_df)
View(state_var_df)
View(w_df)
week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
teacher-1)+week
40*(teacher-1)+week
#how do we get badges???
state_var_df[40*(teacher-1)+week,] = c(week, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
View(state_var_df)
mu_theta_df[40*(teacher-1)+week,2]
mu_theta_df
40*(teacher-1)
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,2]*state_var_df[40*(teacher-1)+week-1,2]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5])
u
mu
mu_theta_df[40*(teacher-1)+week-1,2]
state_var_df[40*(teacher-1)+week-1,2])
state_var_df[40*(teacher-1)+week-1,2])
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6])
mu
#final sim sigma (linear combination)
sigma = exp(as.numeric(sig_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6]))
sigma
minutes = rnorm(1, mean = mu, sd = sigma)
minutes = ifelse(minutes < 0, 0, minutes)
minutes
minutes
minutes
minutes
minutes
#simualted minutes per wee
sim_mins_df[teacher,week] = minutes
View(sim_mins_df)
40*(teacher-1)+week-1
40*(teacher-1)+week-1
40*(teacher-1)+week-1
40*(teacher-1)+week-1
40*(teacher-1)+week-1
40*(teacher-1)+week-1
40*(teacher-1)+week
delta = last_badges +
gamma * state_var_df[40*(teacher-1)+week,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)] -
state_var_df[40*(teacher-1)+week-1,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)]
delta
delta = delta[[1]]
w_df
w_df[1,]
state_var_df[40*(teacher-1)+week,]
state_var_df[40*(teacher-1)+week,c(1:2)]
View(state_var_df)
View(state_var_df)
nweeks <- 40
nteachers = 100
# 1. Initialize: alpha_theta >0, alpha_w > 0; theta_mu, theta_sigma, w (vectors size 4);
# S (x) (which is the vector size 4 we call x’s — badges, tower alerts, squares…)
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
#w starting
w_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(w_df) = c('week', 'teacher', 'w1', 'w2', 'w3', 'w4')
#FIX HERE
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
# 2. Calculate mu and theta. Sample minutes from the resulting normal distribution.
#iteratin
teacher = 1
#selecting thetas MAKE ALL THESE 0 to START
mu_theta_df[40* (teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
sig_theta_df[40*(teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
#starting state variables for each teacher (the same?)
last_badges = 2
last_tower_alerts = 6
state_var_df[40*(teacher-1)+1,] = c(1, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#initializing w for each teacher
w_df[40*(teacher-1)+1,]= c(1, teacher,0, 0, 0, 0)
#making first column teacher
sim_mins_df[teacher,1] = teacher
View(w_df)
week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
#how do we get badges???
state_var_df[40*(teacher-1)+week,] = c(week, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6])
#final sim sigma (linear combination)
sigma = exp(as.numeric(sig_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6]))
minutes = rnorm(1, mean = mu, sd = sigma)
minutes = ifelse(minutes < 0, 0, minutes)
#simualted minutes per wee
sim_mins_df[teacher,week] = minutes
delta = last_badges +
gamma * state_var_df[40*(teacher-1)+week,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)] -
state_var_df[40*(teacher-1)+week-1,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)]
delta = delta[[1]]
state_var_df[40*(teacher-1)+week,c(1:2)]
w_df[40*(teacher-1)+week,c(1:2)]
w_df[40*(teacher-1)+week,c(1:2)]
#4. update w. Like so: w = w + alpha_w * delta * w
#[this is like the updating function we did with each state before]
w_df[40*(teacher-1)+week,c(1:2)] = c(week, teacher)
w_df[40*(teacher-1)+week,c(1:2)]
w_df[week,c(2:5)]
as.vector(w_df[week-1,c(3:6)])
as.vector(w_df[week,c(3:6)])
state_var_df[week-1,c(3:6)]
state_var_df[week-1,c(3:6)]
state_var_df[week-1,c(3:6)]
as.vector(state_var_df[week-1,c(3:6)])
as.vector(w_df[week-1,c(3:6)]) + alpha_w * delta * as.vector(state_var_df[week-1,c(3:6)])
as.vector(state_var_df[40*(teacher-1)+week-1,c(3:6)])
as.vector(w_df[40*(teacher-1)+week-1,c(3:6)])
library(tidyverse)
library(reshape2)
nweeks <- 40
nteachers = 100
# 1. Initialize: alpha_theta >0, alpha_w > 0; theta_mu, theta_sigma, w (vectors size 4);
# S (x) (which is the vector size 4 we call x’s — badges, tower alerts, squares…)
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
#w starting
w_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(w_df) = c('week', 'teacher', 'w1', 'w2', 'w3', 'w4')
#FIX HERE
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
# 2. Calculate mu and theta. Sample minutes from the resulting normal distribution.
#iterating through teachers
for (teacher in 1:nteachers){
teacher = 1
#selecting thetas MAKE ALL THESE 0 to START
mu_theta_df[40* (teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
sig_theta_df[40*(teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
#starting state variables for each teacher (the same?)
last_badges = 2
last_tower_alerts = 6
state_var_df[40*(teacher-1)+1,] = c(1, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#initializing w for each teacher
w_df[40*(teacher-1)+1,]= c(1, teacher,0, 0, 0, 0)
#making first column teacher
sim_mins_df[teacher,1] = teacher
#iterating through weeks
for (week in 2:nweeks) {
week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
#how do we get badges???
state_var_df[40*(teacher-1)+week,] = c(week, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#final sim mu
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6])
#final sim sigma (linear combination)
sigma = exp(as.numeric(sig_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6]))
minutes = rnorm(1, mean = mu, sd = sigma)
minutes = ifelse(minutes < 0, 0, minutes)
#simualted minutes per wee
sim_mins_df[teacher,week] = minutes
#3. calculate delta = badges for the NEXT week + gamma *
#(linear combination of w with x’s for the NEXT week) -
#(linear combination of w with x’s for the THIS week)
#(oh and gamma = 0.95)
delta = last_badges +
gamma * state_var_df[40*(teacher-1)+week,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)] -
state_var_df[40*(teacher-1)+week-1,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)]
delta = delta[[1]]
#4. update w. Like so: w = w + alpha_w * delta * X
#[this is like the updating function we did with each state before]
w_df[40*(teacher-1)+week,c(1:2)] = c(week, teacher)
w_df[40*(teacher-1)+week,c(3:6)] = as.vector(w_df[40*(teacher-1)+week-1,c(3:6)]) + alpha_w * delta * as.vector(state_var_df[40*(teacher-1)+week-1,c(3:6)])
#5. update theta_mu. Like so: theta_mu = theta_mu + alpha_theta * delta*gamma^(week -1#) *
#1/(sigma)^2 * (minutes - mu) * x’s  [this is the first gradient formula from the picture]
mu_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
mu_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = mu_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
1/(sigma^2) * (minutes - mu) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
#6. update theta_sigma. Like so: theta_sigma = theta_sigma + alpha_theta * delta*gamma^(week -1 #) *
#((minutes - mu)^2/(sigma)^2 - 1) * x’s  [this is the second gradient formula from the picture]
sig_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
sig_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
((minutes-mu)^2/((sigma^2-1))) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
}
}
# 7. Loop accordingly until the end of the 40 weeks
View(mu_theta_df)
library(tidyverse)
library(reshape2)
nweeks <- 40
nteachers = 100
# 1. Initialize: alpha_theta >0, alpha_w > 0; theta_mu, theta_sigma, w (vectors size 4);
# S (x) (which is the vector size 4 we call x’s — badges, tower alerts, squares…)
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
#w starting
w_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(w_df) = c('week', 'teacher', 'w1', 'w2', 'w3', 'w4')
#FIX HERE
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
# 2. Calculate mu and theta. Sample minutes from the resulting normal distribution.
#iterating through teachers
for (teacher in 1:nteachers){
#teacher = 1
#selecting thetas MAKE ALL THESE 0 to START
mu_theta_df[40* (teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
sig_theta_df[40*(teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
#starting state variables for each teacher (the same?)
last_badges = 2
last_tower_alerts = 6
state_var_df[40*(teacher-1)+1,] = c(1, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#initializing w for each teacher
w_df[40*(teacher-1)+1,]= c(1, teacher,0, 0, 0, 0)
#making first column teacher
sim_mins_df[teacher,1] = teacher
#iterating through weeks
for (week in 2:nweeks) {
#week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
#how do we get badges???
state_var_df[40*(teacher-1)+week,] = c(week, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#final sim mu
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6])
#final sim sigma (linear combination)
sigma = exp(as.numeric(sig_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6]))
minutes = rnorm(1, mean = mu, sd = sigma)
minutes = ifelse(minutes < 0, 0, minutes)
#simualted minutes per wee
sim_mins_df[teacher,week] = minutes
#3. calculate delta = badges for the NEXT week + gamma *
#(linear combination of w with x’s for the NEXT week) -
#(linear combination of w with x’s for the THIS week)
#(oh and gamma = 0.95)
delta = last_badges +
gamma * state_var_df[40*(teacher-1)+week,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)] -
state_var_df[40*(teacher-1)+week-1,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)]
delta = delta[[1]]
#4. update w. Like so: w = w + alpha_w * delta * X
#[this is like the updating function we did with each state before]
w_df[40*(teacher-1)+week,c(1:2)] = c(week, teacher)
w_df[40*(teacher-1)+week,c(3:6)] = as.vector(w_df[40*(teacher-1)+week-1,c(3:6)]) + alpha_w * delta * as.vector(state_var_df[40*(teacher-1)+week-1,c(3:6)])
# FINISHED THROUGH HERE!!!
#5. update theta_mu. Like so: theta_mu = theta_mu + alpha_theta * delta*gamma^(week -1#) *
#1/(sigma)^2 * (minutes - mu) * x’s  [this is the first gradient formula from the picture]
mu_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
mu_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = mu_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
1/(sigma^2) * (minutes - mu) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
#6. update theta_sigma. Like so: theta_sigma = theta_sigma + alpha_theta * delta*gamma^(week -1 #) *
#((minutes - mu)^2/(sigma)^2 - 1) * x’s  [this is the second gradient formula from the picture]
sig_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
sig_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
((minutes-mu)^2/((sigma^2-1))) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
}
}
# 7. Loop accordingly until the end of the 40 weeks
View(sig_theta_df)
View(sim_mins_df)
View(sim_mins_df)
View(state_var_df)
View(w_df)
View(sim_mins_df)
nweeks <- 40
nteachers = 100
# 1. Initialize: alpha_theta >0, alpha_w > 0; theta_mu, theta_sigma, w (vectors size 4);
# S (x) (which is the vector size 4 we call x’s — badges, tower alerts, squares…)
alpha_theta = .1
alpha_w = .1
gamma = .95
#thetas hyper
mu_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(mu_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
sig_theta_df = matrix(data = NA, nrow = nteachers*nweeks, ncol = 6)
colnames(sig_theta_df) = c('week', 'teacher', 'theta1', 'theta2', 'theta3', 'theta4')
#state_variables_df THIS IS X
state_var_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(state_var_df) = c('week', 'teacher','x1', 'x2', 'x3', 'x4')
#w starting
w_df = matrix(data = NA, nrow = nteachers*nweeks , ncol = 6)
colnames(w_df) = c('week', 'teacher', 'w1', 'w2', 'w3', 'w4')
#FIX HERE
sim_mins_df = matrix(data = NA, nrow = nteachers , ncol = 40)
# 2. Calculate mu and theta. Sample minutes from the resulting normal distribution.
teacher = 1
#selecting thetas MAKE ALL THESE 0 to START
mu_theta_df[40* (teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
sig_theta_df[40*(teacher-1)+1,]  = c(1, teacher, 0, 0, 0, 0)
#starting state variables for each teacher (the same?)
last_badges = 2
last_tower_alerts = 6
state_var_df[40*(teacher-1)+1,] = c(1, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
#initializing w for each teacher
w_df[40*(teacher-1)+1,]= c(1, teacher,0, 0, 0, 0)
#making first column teacher
sim_mins_df[teacher,1] = teacher
week = 2
#hyperparameters get big with the growing weeks
#updating badges
last_badges  = rnorm(1, mean = 2, sd = .5)
last_badges = ifelse(last_badges < 0, 0, last_badges)
last_tower_alerts  = rnorm(1, mean = 6, sd = 1)
last_tower_alerts= ifelse(last_tower_alerts < 0, 0, last_tower_alerts)
#how do we get badges???
state_var_df[40*(teacher-1)+week,] = c(week, teacher, last_tower_alerts, last_badges, last_tower_alerts^2, last_badges^2)
mu = as.numeric(mu_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(mu_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6])
#final sim sigma (linear combination)
sigma = exp(as.numeric(sig_theta_df[40*(teacher-1)+week-1,3]*state_var_df[40*(teacher-1)+week-1,3]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,4]*state_var_df[40*(teacher-1)+week-1,4]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,5]*state_var_df[40*(teacher-1)+week-1,5]) +
as.numeric(sig_theta_df[40*(teacher-1)+week-1,6]*state_var_df[40*(teacher-1)+week-1,6]))
minutes = rnorm(1, mean = mu, sd = sigma)
minutes = ifelse(minutes < 0, 0, minutes)
#simualted minutes per wee
sim_mins_df[teacher,week] = minutes
delta = last_badges +
gamma * state_var_df[40*(teacher-1)+week,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)] -
state_var_df[40*(teacher-1)+week-1,c(2:5)] %*% w_df[40*(teacher-1)+week-1,c(2:5)]
delta = delta[[1]]
#4. update w. Like so: w = w + alpha_w * delta * X
#[this is like the updating function we did with each state before]
w_df[40*(teacher-1)+week,c(1:2)] = c(week, teacher)
w_df[40*(teacher-1)+week,c(3:6)] = as.vector(w_df[40*(teacher-1)+week-1,c(3:6)]) + alpha_w * delta * as.vector(state_var_df[40*(teacher-1)+week-1,c(3:6)])
#5. update theta_mu. Like so: theta_mu = theta_mu + alpha_theta * delta*gamma^(week -1#) *
#1/(sigma)^2 * (minutes - mu) * x’s  [this is the first gradient formula from the picture]
mu_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
View(mu_theta_df)
mu_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)]
mu_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)]
40*(teacher-1)+1 + (week-1)-1
alpha_thet
alpha_theta
delta
gamma^(week-1)
1/(sigma^2)
(minutes - mu)
40*(teacher-1)+1 + (week-1)
40*(teacher-1)+1 + (week-1)-1
40*(teacher-1)+1 + (week-1)
#5. update theta_mu. Like so: theta_mu = theta_mu + alpha_theta * delta*gamma^(week -1#) *
#1/(sigma)^2 * (minutes - mu) * x’s (IS THIS WEEK -1 ???)  [this is the first gradient formula from the picture]
mu_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
mu_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = mu_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
1/(sigma^2) * (minutes - mu) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
View(mu_theta_df)
#6. update theta_sigma. Like so: theta_sigma = theta_sigma + alpha_theta * delta*gamma^(week -1 #) *
#((minutes - mu)^2/(sigma)^2 - 1) * x’s  [this is the second gradient formula from the picture]
sig_theta_df[40*(teacher-1)+1 + (week-1),c(1:2)] = c(week, teacher)
sig_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
((minutes-mu)^2/((sigma^2-1))) *state_var_df[40*(teacher-1)+1 + (week-1),c(2:5)]
View(sig_theta_df)
sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)]
alpha_theta * delta*gamma^(week-1)
((minutes-mu)^2
(minutes-mu)
sig_theta_df[40*(teacher-1)+1 + (week-1),c(3:6)] = sig_theta_df[40*(teacher-1)+1 + (week-1)-1,c(3:6)] + alpha_theta * delta*gamma^(week-1) *
(IS THIS WEEK -1 ???)s>D?  }
minutes-mu
(minutes-mu)^2
((minutes-mu)^2/((sigma^2-1)))
sigma
2-1
sigma^2-1)
